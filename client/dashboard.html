<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Manager - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        select, button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background: #007bff;
            color: white;
            cursor: pointer;
            border: none;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .tree-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .entry {
            padding: 8px 12px;
            border-left: 3px solid transparent;
            margin: 4px 0;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .entry:hover {
            background: #f8f9fa;
        }
        
        /* Indentaci√≥ per nivell */
        .entry[data-depth="0"] { padding-left: 12px; }
        .entry[data-depth="1"] { padding-left: 32px; }
        .entry[data-depth="2"] { padding-left: 52px; }
        .entry[data-depth="3"] { padding-left: 72px; }
        .entry[data-depth="4"] { padding-left: 92px; }
        .entry[data-depth="5"] { padding-left: 112px; }
        
        /* Colors per status_color */
        .entry[data-status="blanc"] { border-left-color: #e9ecef; }
        .entry[data-status="groc"] { border-left-color: #ffc107; background: #fff9e6; }
        .entry[data-status="gris"] { border-left-color: #6c757d; }
        .entry[data-status="vermell"] { border-left-color: #dc3545; background: #ffe6e6; }
        .entry[data-status="blau"] { border-left-color: #007bff; }
        .entry[data-status="taronja"] { border-left-color: #fd7e14; }
        .entry[data-status="verd"] { border-left-color: #28a745; background: #e6ffe6; }
        
        .entry-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .entry-path {
            font-size: 11px;
            color: #6c757d;
            font-family: 'Courier New', monospace;
            min-width: 60px;
        }
        
        .entry-title {
            flex: 1;
            font-weight: 500;
        }
        
        .entry-type {
            font-size: 11px;
            padding: 2px 8px;
            background: #e9ecef;
            border-radius: 3px;
            color: #495057;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #f5c6cb;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 14px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìã Project Manager Dashboard</h1>
            <div class="controls">
                <label>Projecte:</label>
                <select id="projectSelect">
                    <option value="000">000 - Documentaci√≥</option>
                    <option value="001">001 - PM Project Manager</option>
                </select>
                <button onclick="loadProject()">Carregar</button>
                <button onclick="refreshProject()">Refrescar</button>
            </div>
            <div class="stats" id="stats"></div>
        </header>
        
        <div class="tree-container" id="treeContainer">
            <div class="loading">Selecciona un projecte per comen√ßar</div>
        </div>
    </div>

    <script>
        // Configuraci√≥ API
        const API_BASE = 'https://www.contratemps.org/claudetools';
        
        // Icones per tipus
        const TYPE_ICONS = {
            'group': 'üìÅ',
            'memo': 'üìù',
            'check': '‚òëÔ∏è',
            'link': 'üîó'
        };
        
        // Carregar projecte
        async function loadProject() {
            const projectId = document.getElementById('projectSelect').value;
            const container = document.getElementById('treeContainer');
            
            container.innerHTML = '<div class="loading">Carregant...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/api_get_tree.php?project_id=${projectId}`);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                renderTree(data.entries);
                updateStats(data);
                
            } catch (error) {
                container.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }
        
        // Renderitzar arbre
        function renderTree(entries) {
            const container = document.getElementById('treeContainer');
            container.innerHTML = '';
            
            entries.forEach(entry => {
                const div = document.createElement('div');
                div.className = 'entry';
                div.setAttribute('data-depth', entry.depth);
                div.setAttribute('data-status', entry.status_color);
                div.setAttribute('data-type', entry.entry_type);
                div.setAttribute('data-id', entry.id);
                
                // Icon
                const icon = document.createElement('span');
                icon.className = 'entry-icon';
                icon.textContent = TYPE_ICONS[entry.entry_type] || '‚Ä¢';
                
                // Path
                const path = document.createElement('span');
                path.className = 'entry-path';
                path.textContent = entry.full_path;
                
                // Title
                const title = document.createElement('span');
                title.className = 'entry-title';
                title.textContent = entry.title;
                
                // Type badge
                const type = document.createElement('span');
                type.className = 'entry-type';
                type.textContent = entry.entry_type.toUpperCase();
                
                div.appendChild(icon);
                div.appendChild(path);
                div.appendChild(title);
                div.appendChild(type);
                
                // Event listener (futur)
                div.addEventListener('click', () => onEntryClick(entry));
                
                container.appendChild(div);
            });
        }
        
        // Actualitzar estad√≠stiques
        function updateStats(data) {
            const stats = document.getElementById('stats');
            const types = {};
            
            data.entries.forEach(entry => {
                types[entry.entry_type] = (types[entry.entry_type] || 0) + 1;
            });
            
            const parts = [
                `Total: ${data.total_entries}`,
                ...Object.entries(types).map(([type, count]) => `${type}: ${count}`)
            ];
            
            stats.innerHTML = parts.join(' | ');
        }
        
        // Click en entrada (futur)
        function onEntryClick(entry) {
            console.log('Click:', entry);
            // TODO: Implementar edici√≥/visualitzaci√≥
        }
        
        // Refrescar
        function refreshProject() {
            loadProject();
        }
        
        // Carregar projecte per defecte
        window.addEventListener('DOMContentLoaded', () => {
            // Opcional: carregar autom√†ticament el primer projecte
            // loadProject();
        });
    </script>
</body>
</html>
